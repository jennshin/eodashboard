{"version":3,"file":"ol-rotate-feature.esm.js","sources":["../src/util.js","../src/event.js","../src/shim.js","../src/interaction.js","../src/index.js"],"sourcesContent":["/**\n * This file is part of ol-rotate-feature package.\n * @module ol-rotate-feature\n * @license MIT\n * @author Vladimir Vershinin\n */\n\n/**\n * @param {boolean} condition\n * @param {string} message\n * @throws Error\n */\nexport function assert (condition, message = '') {\n  message = [ 'Assertion failed', message ].join(': ')\n\n  if (!condition) {\n    throw new Error(message)\n  }\n}\n\n/**\n * @param {*} arg\n * @returns {*}\n */\nexport function identity (arg) {\n  return arg\n}\n\n/**\n * @param {...*} args\n * @return {*}\n */\nexport function coalesce (...args) {\n  return args.filter(value => value != null).shift()\n}\n\nconst counters = {}\n/**\n * @param {string} [prefix]\n * @return {number}\n */\nexport function uniqId (prefix = '') {\n  const ns = prefix || 'default'\n  counters[ ns ] = counters[ ns ] == null ? 0 : counters[ ns ]\n\n  return String(prefix) + (++counters[ ns ])\n}\n\nexport function includes (arr, value) {\n  return arr.indexOf(value) !== -1\n}\n\nexport function isArray (val) {\n  return val::Object.prototype.toString() === '[object Array]'\n}\n","/**\n * This file is part of ol-rotate-feature package.\n * @module ol-rotate-feature\n * @license MIT\n * @author Vladimir Vershinin\n */\n/**\n * @enum {string}\n */\nexport const RotateFeatureEventType = {\n  /**\n   * Triggered upon feature rotate start.\n   * @event RotateFeatureEvent#rotatestart\n   */\n  START: 'rotatestart',\n  /**\n   * Triggered upon feature rotation.\n   * @event RotateFeatureEvent#rotating\n   */\n  ROTATING: 'rotating',\n  /**\n   * Triggered upon feature rotation end.\n   * @event RotateFeatureEvent#rotateend\n   */\n  END: 'rotateend'\n}\n\n/**\n * Events emitted by RotateFeatureInteraction instances are instances of this type.\n *\n * @class\n * @author Vladimir Vershinin\n */\nexport default class RotateFeatureEvent {\n  /**\n   * @param {string} type Type.\n   * @param {ol.Collection<ol.Feature>} features Rotated features.\n   * @param {number} angle Angle in radians.\n   * @param {ol.Coordinate} anchor Anchor position.\n   */\n  constructor (type, features, angle, anchor) {\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.propagationStopped_ = false\n\n    /**\n     * The event type.\n     * @type {string}\n     * @private\n     */\n    this.type_ = type\n\n    /**\n     * The features being rotated.\n     * @type {ol.Collection<ol.Feature>}\n     * @private\n     */\n    this.features_ = features\n    /**\n     * Current angle in radians.\n     * @type {number}\n     * @private\n     */\n    this.angle_ = angle\n    /**\n     * Current rotation anchor.\n     * @type {ol.Coordinate}\n     * @private\n     */\n    this.anchor_ = anchor\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get propagationStopped () {\n    return this.propagationStopped_\n  }\n\n  /**\n   * @type {string}\n   */\n  get type () {\n    return this.type_\n  }\n\n  /**\n   * @type {ol.Collection<ol.Feature>}\n   */\n  get features () {\n    return this.features_\n  }\n\n  /**\n   * @type {number}\n   */\n  get angle () {\n    return this.angle_\n  }\n\n  /**\n   * @type {ol.Coordinate}\n   */\n  get anchor () {\n    return this.anchor_\n  }\n\n  /**\n   * Prevent event propagation.\n   */\n  preventDefault () {\n    this.propagationStopped_ = true\n  }\n\n  /**\n   * Stop event propagation.\n   */\n  stopPropagation () {\n    this.propagationStopped_ = true\n  }\n}\n","const ua = typeof navigator !== 'undefined' ? navigator.userAgent.toLowerCase() : ''\n\nexport const MAC = ua.indexOf('macintosh') !== -1\n\nexport const WEBKIT = ua.indexOf('webkit') !== -1 && ua.indexOf('edge') == -1\n\nexport const mouseActionButton = function (mapBrowserEvent) {\n  const originalEvent = /** @type {MouseEvent} */ (mapBrowserEvent.originalEvent)\n  return originalEvent.button == 0 && !(WEBKIT && MAC && originalEvent.ctrlKey)\n}\n","/**\n * This file is part of ol-rotate-feature package.\n * @module ol-rotate-feature\n * @license MIT\n * @author Vladimir Vershinin\n */\n/**\n * Rotate interaction class.\n * Adds controls to rotate vector features.\n * Writes out total angle in radians (positive is counter-clockwise) to property for each feature.\n */\nimport { Pointer as PointerInteraction } from 'ol/interaction'\nimport { Collection, Feature } from 'ol'\nimport { Vector as VectorLayer } from 'ol/layer'\nimport { Vector as VectorSource } from 'ol/source'\nimport { GeometryCollection, Point, Polygon } from 'ol/geom'\nimport { Fill, RegularShape, Stroke, Style, Text } from 'ol/style'\nimport { getCenter as getExtentCenter } from 'ol/extent'\nimport { always, mouseOnly } from 'ol/events/condition'\nimport { assert, identity, includes, isArray } from './util'\nimport RotateFeatureEvent, { RotateFeatureEventType } from './event'\nimport { mouseActionButton } from './shim'\n\nconst ANCHOR_KEY = 'rotate-anchor'\nconst ARROW_KEY = 'rotate-arrow'\n\nconst ANGLE_PROP = 'angle'\nconst ANCHOR_PROP = 'anchor'\n\n/**\n * @todo todo добавить опцию condition - для возможности переопределения клавиш\n */\nexport default class RotateFeatureInteraction extends PointerInteraction {\n  /**\n   * @param {InteractionOptions} options\n   */\n  constructor (options = {}) {\n    super({\n      // handleEvent: handleEvent,\n      handleDownEvent,\n      handleUpEvent,\n      handleDragEvent,\n      handleMoveEvent,\n    })\n    /**\n     * @type {string}\n     * @private\n     */\n    this.previousCursor_ = undefined\n    /**\n     * @type {Feature}\n     * @private\n     */\n    this.anchorFeature_ = undefined\n    /**\n     * @type {Feature}\n     * @private\n     */\n    this.arrowFeature_ = undefined\n    /**\n     * @type {Coordinate}\n     * @private\n     */\n    this.lastCoordinate_ = undefined\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.anchorMoving_ = false\n    /**\n     * @type {Vector}\n     * @private\n     */\n    this.overlay_ = new VectorLayer({\n      style: options.style || getDefaultStyle(),\n      source: new VectorSource({\n        features: new Collection(),\n      }),\n    })\n    /**\n     * @private\n     * @type {module:ol/events/condition~Condition}\n     */\n    this.condition_ = options.condition ? options.condition : always\n    /**\n     * @type {Collection<Feature>}\n     * @private\n     */\n    this.features_ = undefined\n    if (options.features) {\n      if (isArray(options.features)) {\n        this.features_ = new Collection(options.features)\n      } else if (options.features instanceof Collection) {\n        this.features_ = options.features\n      } else {\n        throw new Error('Features option should be an array or collection of features, ' +\n          'got ' + (typeof options.features))\n      }\n    } else {\n      this.features_ = new Collection()\n    }\n\n    /**\n     * @type {boolean}\n     * @public\n     */\n    this.allowAnchorMovement = options.allowAnchorMovement === undefined ? true : options.allowAnchorMovement\n\n    this.setAnchor(options.anchor || getFeaturesCentroid(this.features_))\n    this.setAngle(options.angle || 0)\n\n    this.features_.on('add', ::this.onFeatureAdd_)\n    this.features_.on('remove', ::this.onFeatureRemove_)\n    this.on('change:' + ANGLE_PROP, ::this.onAngleChange_)\n    this.on('change:' + ANCHOR_PROP, ::this.onAnchorChange_)\n\n    this.createOrUpdateAnchorFeature_()\n    this.createOrUpdateArrowFeature_()\n  }\n\n  /**\n   * @type {Collection<Feature>}\n   */\n  get features () {\n    return this.features_\n  }\n\n  /**\n   * @type {number}\n   */\n  get angle () {\n    return this.getAngle()\n  }\n\n  /**\n   * @param {number} angle\n   */\n  set angle (angle) {\n    this.setAngle(angle)\n  }\n\n  /**\n   * @type {Coordinate|number[]|undefined}\n   */\n  get anchor () {\n    return this.getAnchor()\n  }\n\n  /**\n   * @param {Coordinate|undefined} anchor\n   */\n  set anchor (anchor) {\n    this.setAnchor(anchor)\n  }\n\n  /**\n   * @param {PluggableMap} map\n   */\n  set map (map) {\n    this.setMap(map)\n  }\n\n  /**\n   * @type {PluggableMap}\n   */\n  get map () {\n    return this.getMap()\n  }\n\n  /**\n   * @param {boolean} active\n   */\n  set active (active) {\n    this.setActive(active)\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get active () {\n    return this.getActive()\n  }\n\n  /**\n   * @param {ol.Map} map\n   */\n  setMap (map) {\n    this.overlay_.setMap(map)\n    super.setMap(map)\n  }\n\n  /**\n   * @param {boolean} active\n   */\n  setActive (active) {\n    if (this.overlay_) {\n      this.overlay_.setMap(active ? this.map : undefined)\n    }\n\n    super.setActive(active)\n  }\n\n  /**\n   * Set current angle of interaction features.\n   *\n   * @param {number} angle\n   */\n  setAngle (angle) {\n    assert(!isNaN(parseFloat(angle)), 'Numeric value passed')\n\n    this.set(ANGLE_PROP, parseFloat(angle))\n  }\n\n  /**\n   * Returns current angle of interaction features.\n   *\n   * @return {number}\n   */\n  getAngle () {\n    return this.get(ANGLE_PROP)\n  }\n\n  /**\n   * Set current anchor position.\n   *\n   * @param {Coordinate | undefined} anchor\n   */\n  setAnchor (anchor) {\n    assert(anchor == null || isArray(anchor) && anchor.length === 2, 'Array of two elements passed')\n\n    this.set(ANCHOR_PROP, anchor != null ? anchor.map(parseFloat) : getFeaturesCentroid(this.features_))\n  }\n\n  /**\n   * Returns current anchor position.\n   *\n   * @return {Coordinate | undefined}\n   */\n  getAnchor () {\n    return this.get(ANCHOR_PROP)\n  }\n\n  /**\n   * @private\n   */\n  createOrUpdateAnchorFeature_ () {\n    const angle = this.getAngle()\n    const anchor = this.getAnchor()\n\n    if (!anchor) return\n\n    if (this.anchorFeature_) {\n      this.anchorFeature_.getGeometry().setCoordinates(anchor)\n      this.anchorFeature_.set(ANGLE_PROP, angle)\n    } else {\n      this.anchorFeature_ = new Feature({\n        geometry: new Point(anchor),\n        [ANGLE_PROP]: angle,\n        [ANCHOR_KEY]: true,\n      })\n      this.overlay_.getSource().addFeature(this.anchorFeature_)\n    }\n  }\n\n  /**\n   * @private\n   */\n  createOrUpdateArrowFeature_ () {\n    const angle = this.getAngle()\n    const anchor = this.getAnchor()\n\n    if (!anchor) return\n\n    if (this.arrowFeature_) {\n      this.arrowFeature_.getGeometry().setCoordinates(anchor)\n      this.arrowFeature_.set(ANGLE_PROP, angle)\n    } else {\n      this.arrowFeature_ = new Feature({\n        geometry: new Point(anchor),\n        [ANGLE_PROP]: angle,\n        [ARROW_KEY]: true,\n      })\n      this.overlay_.getSource().addFeature(this.arrowFeature_)\n    }\n  }\n\n  /**\n   * @private\n   */\n  resetAngleAndAnchor_ () {\n    this.resetAngle_()\n    this.resetAnchor_()\n  }\n\n  /**\n   * @private\n   */\n  resetAngle_ () {\n    this.set(ANGLE_PROP, 0, true)\n    this.arrowFeature_ && this.arrowFeature_.set(ANGLE_PROP, this.getAngle())\n    this.anchorFeature_ && this.anchorFeature_.set(ANGLE_PROP, this.getAngle())\n  }\n\n  /**\n   * @private\n   */\n  resetAnchor_ () {\n    this.set(ANCHOR_PROP, getFeaturesCentroid(this.features_), true)\n\n    if (this.getAnchor()) {\n      this.arrowFeature_ && this.arrowFeature_.getGeometry().setCoordinates(this.getAnchor())\n      this.anchorFeature_ && this.anchorFeature_.getGeometry().setCoordinates(this.getAnchor())\n    }\n  }\n\n  /**\n   * @private\n   */\n  onFeatureAdd_ () {\n    this.resetAngleAndAnchor_()\n    this.createOrUpdateAnchorFeature_()\n    this.createOrUpdateArrowFeature_()\n  }\n\n  /**\n   * @private\n   */\n  onFeatureRemove_ () {\n    this.resetAngleAndAnchor_()\n\n    if (this.features_.getLength()) {\n      this.createOrUpdateAnchorFeature_()\n      this.createOrUpdateArrowFeature_()\n    } else {\n      this.overlay_.getSource().clear()\n      this.anchorFeature_ = this.arrowFeature_ = undefined\n    }\n  }\n\n  /**\n   * @private\n   */\n  onAngleChange_ ({oldValue}) {\n    this.features_.forEach(feature => feature.getGeometry().rotate(this.getAngle() - oldValue, this.getAnchor()))\n    this.arrowFeature_ && this.arrowFeature_.set(ANGLE_PROP, this.getAngle())\n    this.anchorFeature_ && this.anchorFeature_.set(ANGLE_PROP, this.getAngle())\n  }\n\n  /**\n   * @private\n   */\n  onAnchorChange_ () {\n    const anchor = this.getAnchor()\n\n    if (anchor) {\n      this.anchorFeature_ && this.anchorFeature_.getGeometry().setCoordinates(anchor)\n      this.arrowFeature_ && this.arrowFeature_.getGeometry().setCoordinates(anchor)\n    }\n  }\n\n  /**\n   * @param {Collection<Feature>} features\n   * @private\n   */\n  dispatchRotateStartEvent_ (features) {\n    this.dispatchEvent(\n      new RotateFeatureEvent(\n        RotateFeatureEventType.START,\n        features,\n        this.getAngle(),\n        this.getAnchor(),\n      ),\n    )\n  }\n\n  /**\n   * @param {Collection<Feature>} features\n   * @private\n   */\n  dispatchRotatingEvent_ (features) {\n    this.dispatchEvent(\n      new RotateFeatureEvent(\n        RotateFeatureEventType.ROTATING,\n        features,\n        this.getAngle(),\n        this.getAnchor(),\n      ),\n    )\n  }\n\n  /**\n   * @param {Collection<Feature>} features\n   * @private\n   */\n  dispatchRotateEndEvent_ (features) {\n    this.dispatchEvent(\n      new RotateFeatureEvent(\n        RotateFeatureEventType.END,\n        features,\n        this.getAngle(),\n        this.getAnchor(),\n      ),\n    )\n  }\n}\n\n/**\n * @param {MapBrowserEvent} evt Map browser event.\n * @return {boolean} `false` to stop event propagation.\n * @this {RotateFeatureInteraction}\n * @private\n */\n// function handleEvent (evt) {\n//   // disable selection of inner features\n//   const foundFeature = evt.map.forEachFeatureAtPixel(evt.pixel, identity)\n//   if (\n//     includes([ 'click', 'singleclick', 'dblclick' ], evt.type) &&\n//     includes([ this.anchorFeature_, this.arrowFeature_ ], foundFeature)\n//   ) {\n//     return false\n//   }\n//\n//   return this::baseHandleEvent(evt)\n// }\n\n/**\n * @param {MapBrowserEvent} evt Event.\n * @return {boolean}\n * @this {RotateFeatureInteraction}\n * @private\n */\nfunction handleDownEvent (evt) {\n  if (!mouseOnly(evt)) {\n    return false\n  }\n\n  if (mouseActionButton(evt) && this.condition_(evt)) {\n    // disable selection of inner features\n    const foundFeature = evt.map.forEachFeatureAtPixel(evt.pixel, identity)\n    if (\n      includes(['click', 'singleclick', 'dblclick'], evt.type) &&\n      includes([this.anchorFeature_, this.arrowFeature_], foundFeature)\n    ) {\n      return false\n    }\n    // handle click & drag on features for rotation\n    if (\n      foundFeature && !this.lastCoordinate_ &&\n      (\n        includes(this.features_.getArray(), foundFeature) ||\n        foundFeature === this.arrowFeature_\n      )\n    ) {\n      this.lastCoordinate_ = evt.coordinate\n\n      this::handleMoveEvent(evt)\n      this.dispatchRotateStartEvent_(this.features_)\n\n      return true\n    }\n    // handle click & drag on rotation anchor feature\n    else if (foundFeature && foundFeature === this.anchorFeature_ && this.allowAnchorMovement) {\n      this.anchorMoving_ = true\n      this::handleMoveEvent(evt)\n\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * @param {MapBrowserEvent} evt Event.\n * @return {boolean}\n * @this {RotateFeatureInteraction}\n * @private\n */\nfunction handleUpEvent (evt) {\n  // stop drag sequence of features\n  if (this.lastCoordinate_) {\n    this.lastCoordinate_ = undefined\n\n    this::handleMoveEvent(evt)\n    this.dispatchRotateEndEvent_(this.features_)\n\n    return true\n  }\n  // stop drag sequence of the anchors\n  else if (this.anchorMoving_) {\n    this.anchorMoving_ = false\n    this::handleMoveEvent(evt)\n\n    return true\n  }\n\n  return false\n}\n\n/**\n * @param {MapBrowserEvent} evt Event.\n * @return {boolean}\n * @this {RotateFeatureInteraction}\n * @private\n */\nfunction handleDragEvent ({coordinate}) {\n  const anchorCoordinate = this.anchorFeature_.getGeometry().getCoordinates()\n\n  // handle drag of features by angle\n  if (this.lastCoordinate_) {\n    // calculate vectors of last and current pointer positions\n    const lastVector = [\n      this.lastCoordinate_[0] - anchorCoordinate[0],\n      this.lastCoordinate_[1] - anchorCoordinate[1],\n    ]\n    const newVector = [\n      coordinate[0] - anchorCoordinate[0],\n      coordinate[1] - anchorCoordinate[1],\n    ]\n\n    // calculate angle between last and current vectors (positive angle counter-clockwise)\n    let angle = Math.atan2(\n      lastVector[0] * newVector[1] - newVector[0] * lastVector[1],\n      lastVector[0] * newVector[0] + lastVector[1] * newVector[1],\n    )\n\n    this.setAngle(this.getAngle() + angle)\n    this.dispatchRotatingEvent_(this.features_)\n\n    this.lastCoordinate_ = coordinate\n  }\n  // handle drag of the anchor\n  else if (this.anchorMoving_) {\n    this.setAnchor(coordinate)\n  }\n}\n\n/**\n * @param {MapBrowserEvent} evt Event.\n * @return {boolean}\n * @this {RotateFeatureInteraction}\n * @private\n */\nfunction handleMoveEvent ({map, pixel}) {\n  const elem = map.getTargetElement()\n  const foundFeature = map.forEachFeatureAtPixel(pixel, identity)\n\n  const setCursor = (cursor, vendor = false) => {\n    if (vendor) {\n      elem.style.cursor = '-webkit-' + cursor\n      elem.style.cursor = '-moz-' + cursor\n    }\n\n    elem.style.cursor = cursor\n  }\n\n  if (this.lastCoordinate_) {\n    this.previousCursor_ = elem.style.cursor\n    setCursor('grabbing', true)\n  } else if (\n    foundFeature &&\n    (\n      includes(this.features_.getArray(), foundFeature) ||\n      foundFeature === this.arrowFeature_\n    )\n  ) {\n    this.previousCursor_ = elem.style.cursor\n    setCursor('grab', true)\n  } else if ((foundFeature && foundFeature === this.anchorFeature_ && this.allowAnchorMovement) || this.anchorMoving_) {\n    this.previousCursor_ = elem.style.cursor\n    setCursor('crosshair')\n  } else {\n    setCursor(this.previousCursor_ || '')\n    this.previousCursor_ = undefined\n  }\n}\n\n/**\n * @returns {StyleFunction}\n * @private\n */\nfunction getDefaultStyle () {\n  const white = [255, 255, 255, 0.8]\n  const blue = [0, 153, 255, 0.8]\n  const transparent = [255, 255, 255, 0.01]\n  const width = 2\n\n  const styles = {\n    [ANCHOR_KEY]: [\n      new Style({\n        image: new RegularShape({\n          fill: new Fill({\n            color: [0, 153, 255, 0.8],\n          }),\n          stroke: new Stroke({\n            color: blue,\n            width: 1,\n          }),\n          radius: 4,\n          points: 6,\n        }),\n        zIndex: Infinity,\n      }),\n    ],\n    [ARROW_KEY]: [\n      new Style({\n        fill: new Fill({\n          color: transparent,\n        }),\n        stroke: new Stroke({\n          color: white,\n          width: width + 2,\n        }),\n        text: new Text({\n          font: '12px sans-serif',\n          offsetX: 20,\n          offsetY: -20,\n          fill: new Fill({\n            color: 'blue',\n          }),\n          stroke: new Stroke({\n            color: white,\n            width: width + 1,\n          }),\n        }),\n        zIndex: Infinity,\n      }),\n      new Style({\n        fill: new Fill({\n          color: transparent,\n        }),\n        stroke: new Stroke({\n          color: blue,\n          width,\n        }),\n        zIndex: Infinity,\n      }),\n    ],\n  }\n\n  return function (feature, resolution) {\n    let style\n    const angle = feature.get(ANGLE_PROP) || 0\n\n    switch (true) {\n      case feature.get(ANCHOR_KEY):\n        style = styles[ANCHOR_KEY]\n        style[0].getImage().setRotation(-angle)\n\n        return style\n      case feature.get(ARROW_KEY):\n        style = styles[ARROW_KEY]\n\n        const coordinates = feature.getGeometry().getCoordinates()\n        // generate arrow polygon\n        const geom = new Polygon([\n          [\n            [coordinates[0], coordinates[1] - 6 * resolution],\n            [coordinates[0] + 8 * resolution, coordinates[1] - 12 * resolution],\n            [coordinates[0], coordinates[1] + 30 * resolution],\n            [coordinates[0] - 8 * resolution, coordinates[1] - 12 * resolution],\n            [coordinates[0], coordinates[1] - 6 * resolution],\n          ],\n        ])\n\n        // and rotate it according to current angle\n        geom.rotate(angle, coordinates)\n        style[0].setGeometry(geom)\n        style[1].setGeometry(geom)\n        style[0].getText().setText(Math.round(-angle * 180 / Math.PI) + '°')\n\n        return style\n    }\n  }\n}\n\n/**\n * @param {Collection<Feature>|Array<Feature>} features\n * @returns {Extent | number[] | undefined}\n * @private\n */\nfunction getFeaturesExtent (features) {\n  features = features instanceof Collection ? features.getArray() : features\n  if (!features.length) return\n\n  return new GeometryCollection(features.map(feature => feature.getGeometry())).getExtent()\n}\n\n/**\n * @param {Collection<ol.Feature> | Array<Feature>} features\n * @return {Coordinate | number[] | undefined}\n */\nfunction getFeaturesCentroid (features) {\n  features = features instanceof Collection ? features.getArray() : features\n  if (!features.length) return\n\n  return getExtentCenter(getFeaturesExtent(features))\n}\n","/**\n * This file is part of ol-rotate-feature package.\n * @module ol-rotate-feature\n * @license MIT\n * @author Vladimir Vershinin\n */\nimport RotateFeatureInteraction from \"./interaction\"\n\n// for backward compatibility\nif (typeof window !== 'undefined' && window.ol && window.ol.interaction) {\n  window.ol.interaction.RotateFeature = RotateFeatureInteraction\n}\n\nexport default RotateFeatureInteraction\n"],"names":["assert","condition","message","join","Error","identity","arg","includes","arr","value","indexOf","isArray","val","Object","prototype","toString","RotateFeatureEventType","START","ROTATING","END","RotateFeatureEvent","type","features","angle","anchor","propagationStopped_","type_","features_","angle_","anchor_","ua","navigator","userAgent","toLowerCase","MAC","WEBKIT","mouseActionButton","mapBrowserEvent","originalEvent","button","ctrlKey","ANCHOR_KEY","ARROW_KEY","ANGLE_PROP","ANCHOR_PROP","RotateFeatureInteraction","options","handleDownEvent","handleUpEvent","handleDragEvent","handleMoveEvent","previousCursor_","undefined","anchorFeature_","arrowFeature_","lastCoordinate_","anchorMoving_","overlay_","VectorLayer","style","getDefaultStyle","source","VectorSource","Collection","condition_","always","allowAnchorMovement","setAnchor","getFeaturesCentroid","setAngle","on","onFeatureAdd_","onFeatureRemove_","onAngleChange_","onAnchorChange_","createOrUpdateAnchorFeature_","createOrUpdateArrowFeature_","map","setMap","active","isNaN","parseFloat","set","get","length","getAngle","getAnchor","getGeometry","setCoordinates","Feature","geometry","Point","getSource","addFeature","resetAngle_","resetAnchor_","resetAngleAndAnchor_","getLength","clear","oldValue","forEach","feature","rotate","dispatchEvent","getMap","setActive","getActive","PointerInteraction","evt","mouseOnly","foundFeature","forEachFeatureAtPixel","pixel","getArray","coordinate","dispatchRotateStartEvent_","dispatchRotateEndEvent_","anchorCoordinate","getCoordinates","lastVector","newVector","Math","atan2","dispatchRotatingEvent_","elem","getTargetElement","setCursor","cursor","vendor","white","blue","transparent","width","styles","Style","image","RegularShape","fill","Fill","color","stroke","Stroke","radius","points","zIndex","Infinity","text","Text","font","offsetX","offsetY","resolution","getImage","setRotation","coordinates","geom","Polygon","setGeometry","getText","setText","round","PI","getFeaturesExtent","GeometryCollection","getExtent","getExtentCenter","window","ol","interaction","RotateFeature"],"mappings":"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"}