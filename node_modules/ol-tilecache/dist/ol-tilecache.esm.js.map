{"version":3,"file":"ol-tilecache.esm.js","sources":["../src/util.js","../src/tile-url-function.js","../src/index.js"],"sourcesContent":["/**\n * This file is part of ol-tilecache package.\n * @module ol-tilecache\n * @license MIT\n * @author Vladimir Vershinin\n */\n\n/**\n * Left zero pad.\n *\n * @param {string | number} num\n * @param {number} places\n * @returns {string}\n */\nexport function zeroPad (num, places) {\n  const zero = places - num.toString().length + 1\n\n  return (new Array(parseInt(zero > 0 && zero, 10)).join(\"0\") + num)\n    .toString()\n    .slice(-places)\n}\n\n/**\n * The % operator in JavaScript returns the remainder of a / b, but differs from\n * some other languages in that the result will have the same sign as the\n * dividend. For example, -1 % 8 == -1, whereas in some other languages\n * (such as Python) the result would be 7. This function emulates the more\n * correct modulo behavior, which is useful for certain applications such as\n * calculating an offset index in a circular list.\n *\n * @param {number} a The dividend.\n * @param {number} b The divisor.\n * @return {number} a % b where the result is between 0 and b (either 0 <= x < b\n *     or b < x <= 0, depending on the sign of b).\n * @link https://closure-library.googlecode.com/git-history/docs/local_closure_goog_math_math.js.source.html#line73\n */\nexport function modulo (a, b) {\n  const m = a % b\n\n  return (m * b) < 0 ? m + b : m\n}\n","/**\n * This file is part of ol-tilecache package.\n * @module ol-tilecache\n * @license MIT\n * @author Vladimir Vershinin\n */\nimport { createXYZ } from 'ol/tilegrid'\nimport { modulo, zeroPad } from './util'\n\nconst zRegEx = /{z}/g\nconst zPadRegEx = /{0z}/g\nconst xRegEx = /{x\\d?}/g\nconst yRegEx = /{y\\d?}/g\nconst dashYRegEx = /{-y\\d?}/g\n\n/**\n * Basic create factory.\n *\n * @param {string} url Url template\n * @param {TileGrid} [tileGrid] Tile grid.\n * @returns {function(tileCoord: TileCoord)}\n * @static\n * @public\n */\nexport function createTileUrlFunction (url, tileGrid = createXYZ()) {\n  return createTileUrlFunctionFromTemplates(expandUrl(url), tileGrid)\n}\n\n/**\n * Creates tile URL function from single template.\n *\n * @param {string} template Source url\n * @param {TileGrid} [tileGrid] Tile grid.\n * @returns {function(tileCoord: TileCoord)}\n * @private\n */\nexport function createTileUrlFunctionFromTemplate (template, tileGrid = createXYZ()) {\n  return (\n    /**\n     * @param {TileCoord} tileCoord Tile Coordinate.\n     * @return {string | undefined} Tile URL.\n     */\n    function (tileCoord) {\n      if (tileCoord != null) {\n        return template.replace(zRegEx, zoomReplacer(tileCoord[0]))\n          .replace(zPadRegEx, zoomReplacer(tileCoord[0], true))\n          .replace(xRegEx, coordReplacer(tileCoord[1]))\n          .replace(yRegEx, coordReplacer(tileCoord[2]))\n          .replace(dashYRegEx, function (part) {\n            const z = tileCoord[0]\n            const range = tileGrid.getFullTileRange(z)\n            if (!range) throw new Error('The {-y} placeholder requires a tile grid with extent.')\n            const y = range.getHeight() - tileCoord[2] - 1\n\n            return coordReplacer(y)(part)\n          })\n      }\n    })\n}\n\n/**\n * Creates tile URL function from multiple templates.\n *\n * @param {string[]} templates Url templates\n * @param {TileGrid} [tileGrid] Tile grid.\n * @returns {function(tileCoord: TileCoord)}\n * @private\n */\nexport function createTileUrlFunctionFromTemplates (templates, tileGrid = createXYZ()) {\n  return createTileUrlFunctionFromTileUrlFunctions(\n    templates.map(tileUrlFunction => createTileUrlFunctionFromTemplate(tileUrlFunction, tileGrid)),\n  )\n}\n\n/**\n * @param zoom\n * @param pad\n * @returns {function}\n * @private\n */\nfunction zoomReplacer (zoom, pad) {\n  return function () {\n    return pad ? zeroPad(zoom, 2) : zoom.toString()\n  }\n}\n\n/**\n * @param coord\n * @returns {function}\n * @private\n */\nfunction coordReplacer (coord) {\n  return function (part) {\n    const match = part.match(/\\d/)\n\n    if (match) {\n      return zeroPad(coord, 9).slice((match[0] - 1) * 3, match[0] * 3)\n    }\n\n    return coord.toString()\n  }\n}\n\n/**\n * @param {string} url\n * @returns {Array.<string>}\n * @private\n */\nfunction expandUrl (url) {\n  const urls = []\n  const match = /{(\\d)-(\\d)}/.exec(url) ||\n    /{([a-z])-([a-z])}/.exec(url)\n\n  if (match) {\n    const startCharCode = match[1].charCodeAt(0)\n    const stopCharCode = match[2].charCodeAt(0)\n\n    for (let charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      urls.push(url.replace(match[0], String.fromCharCode(charCode)))\n    }\n  } else {\n    urls.push(url)\n  }\n\n  return urls\n}\n\n/**\n * @param {Array.<function(tileCoord: TileCoord)>} tileUrlFunctions\n * @returns {function(tileCoord: TileCoord)}\n * @private\n */\nfunction createTileUrlFunctionFromTileUrlFunctions (tileUrlFunctions) {\n  if (tileUrlFunctions.length === 1) {\n    return tileUrlFunctions[0]\n  }\n\n  return (\n    /**\n     * @param {TileCoord} tileCoord Tile Coordinate.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {Projection} projection Projection.\n     * @return {string | undefined} Tile URL.\n     */\n    function (tileCoord, pixelRatio, projection) {\n      if (tileCoord != null) {\n        const h = (tileCoord[1] << tileCoord[0]) + tileCoord[2]\n        const index = modulo(h, tileUrlFunctions.length)\n\n        return tileUrlFunctions[index](tileCoord, pixelRatio, projection)\n      }\n    })\n}\n","/**\n * This file is part of ol-tilecache package.\n * @module ol-tilecache\n * @license MIT\n * @author Vladimir Vershinin\n */\nimport {\n  createTileUrlFunction,\n  createTileUrlFunctionFromTemplate,\n  createTileUrlFunctionFromTemplates,\n} from './tile-url-function'\n\nexport {\n  createTileUrlFunction,\n  createTileUrlFunctionFromTemplate,\n  createTileUrlFunctionFromTemplates\n}\n\n// for backward compatibility\nif (typeof window !== 'undefined' && typeof window.ol === 'object') {\n  window.ol.tileCacheUrlFn = {\n    createTileUrlFunction,\n    createTileUrlFunctionFromTemplate,\n    createTileUrlFunctionFromTemplates,\n  }\n}\n"],"names":["zeroPad","num","places","zero","toString","length","Array","parseInt","join","slice","modulo","a","b","m","zRegEx","zPadRegEx","xRegEx","yRegEx","dashYRegEx","createTileUrlFunction","url","tileGrid","createXYZ","createTileUrlFunctionFromTemplates","expandUrl","createTileUrlFunctionFromTemplate","template","tileCoord","replace","zoomReplacer","coordReplacer","part","z","range","getFullTileRange","Error","y","getHeight","templates","createTileUrlFunctionFromTileUrlFunctions","map","tileUrlFunction","zoom","pad","coord","match","urls","exec","startCharCode","charCodeAt","stopCharCode","charCode","push","String","fromCharCode","tileUrlFunctions","pixelRatio","projection","h","index","window","ol","tileCacheUrlFn"],"mappings":"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"}